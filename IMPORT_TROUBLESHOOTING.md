# Устранение проблем с импортом CSV

## Проблема: 404 ошибка при импорте

Если вы получаете ошибку `404 (Not Found)` при попытке импорта CSV файлов, это обычно связано с кэшированием браузера.

## Проблема: Ошибка валидации даты при импорте ремонтов

Если вы получаете ошибку `Input should be a valid string [type=string_type, input_value=datetime.date(...)]` при импорте ремонтов, это означает, что сервер не был перезапущен после обновления кода.

## Проблема: Ошибка кодировки при импорте

Если вы получаете ошибку `'utf-8' codec can't decode byte 0xe4 in position 108: invalid continuation byte`, это означает, что CSV файл имеет кодировку, отличную от UTF-8 (например, Windows-1251 или CP1251).

## Проблема: Неправильный формат даты

Если вы получаете ошибку `Invalid date format. Expected YYYY-MM-DD`, это означает, что в CSV файле используется неподдерживаемый формат даты.

## Проблема: Неправильный формат стоимости

Если вы получаете ошибку `Input should be a valid integer, unable to parse string as an integer`, это означает, что поле `cost_cents` содержит неправильный формат стоимости.

## Решения:

### 1. Очистка кэша браузера
- **Chrome/Edge**: Нажмите `Ctrl + Shift + R` (принудительное обновление)
- **Firefox**: Нажмите `Ctrl + F5`
- Или очистите кэш браузера через настройки

### 2. Открыть в режиме инкогнито
- Откройте новую вкладку в режиме инкогнито/приватном режиме
- Перейдите на `http://localhost:8000`
- Попробуйте импорт снова

### 3. Проверка сервера
Убедитесь, что сервер запущен:
```bash
python main.py
```

### 4. Перезапуск сервера при ошибках валидации
Если получаете ошибки валидации (особенно с датами), перезапустите сервер:
```bash
# Остановить сервер (Ctrl+C)
# Затем запустить заново
python main.py
```

### 5. Решение проблем с кодировкой
Система автоматически определяет кодировку файла и поддерживает:
- UTF-8
- UTF-8 с BOM
- Windows-1251 (CP1251)
- Latin1

Если файл все еще не читается, попробуйте:
1. Открыть файл в текстовом редакторе (например, Notepad++)
2. Сохранить в кодировке UTF-8
3. Попробовать импорт снова

### 6. Поддерживаемые форматы дат
Система автоматически определяет и поддерживает следующие форматы дат:
- **YYYY-MM-DD** (2024-01-15)
- **DD.MM.YYYY** (15.01.2024)
- **DD/MM/YYYY** (15/01/2024)
- **DD-MM-YYYY** (15-01-2024)
- **MM/DD/YYYY** (01/15/2024) - американский формат
- **YYYY.MM.DD** (2024.01.15)

Если дата в неподдерживаемом формате, преобразуйте её в один из поддерживаемых форматов.

### 7. Поддерживаемые форматы стоимости
Система автоматически преобразует различные форматы стоимости в центы:
- **Десятичные числа**: `643.36` → 64336 центов ($643.36)
- **С валютными символами**: `$150.50`, `€100.25`, `₽500.75` → автоматически удаляются символы
- **Уже в центах**: `25000` → 25000 центов ($250.00)
- **Числа без десятичных**: `100` → 10000 центов ($100.00)

Система автоматически определяет, является ли число суммой в долларах (конвертирует в центы) или уже в центах.

### 8. Проверка endpoints
Откройте в браузере: `http://localhost:8000/docs`
Найдите endpoints:
- `POST /api/import/assets`
- `POST /api/import/repairs`

## Формат CSV файлов:

### Для активов (Assets):
```csv
name;type
House on Main Street;house
Apartment Building A;apartment
```

### Для ремонтов (Repairs):
```csv
asset_name;date;description;performed_by;notes;cost_cents;status
House on Main Street;2024-01-15;Roof repair;John Smith;Fixed leak;25000;COMPLETED
```

## Примеры файлов:
- `example_assets.csv` - пример корректных данных активов
- `example_repairs.csv` - пример корректных данных ремонтов

## Тестирование:
Для проверки работы API используйте:
```bash
python test_csv_import.py
```
